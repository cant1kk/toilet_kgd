{"ast":null,"code":"import WebApp from'@twa-dev/sdk';class TelegramService{constructor(){this.isInitialized=false;this.user=null;this.mainButtonCallback=null;this.backButtonCallback=null;}init(){if(typeof window!=='undefined'&&!this.isInitialized){try{var _window$Telegram;// Проверяем, что мы в Telegram WebApp\nif(!((_window$Telegram=window.Telegram)!==null&&_window$Telegram!==void 0&&_window$Telegram.WebApp)){console.warn('Not in Telegram WebApp environment');return;}WebApp.ready();WebApp.expand();// Включаем подтверждение закрытия\nif(WebApp.enableClosingConfirmation){WebApp.enableClosingConfirmation();}// Устанавливаем тему\nif(WebApp.colorScheme){document.documentElement.setAttribute('data-theme',WebApp.colorScheme);}// Применяем цветовую схему Telegram\nthis.applyTelegramTheme();// Получаем данные пользователя\nif(WebApp.initDataUnsafe.user){this.user=WebApp.initDataUnsafe.user;}// Настройка кнопки \"Назад\"\nif(WebApp.BackButton&&WebApp.BackButton.onClick){WebApp.BackButton.onClick(()=>{if(this.backButtonCallback){this.backButtonCallback();}else{window.history.back();}});}// Настройка главной кнопки с улучшенной поддержкой\nif(WebApp.MainButton&&WebApp.MainButton.setParams){var _WebApp$themeParams,_WebApp$themeParams2;WebApp.MainButton.setParams({text:'Продолжить',color:((_WebApp$themeParams=WebApp.themeParams)===null||_WebApp$themeParams===void 0?void 0:_WebApp$themeParams.button_color)||'#007bff',text_color:((_WebApp$themeParams2=WebApp.themeParams)===null||_WebApp$themeParams2===void 0?void 0:_WebApp$themeParams2.button_text_color)||'#ffffff'});// Устанавливаем обработчик по умолчанию\nif(WebApp.MainButton.onClick){WebApp.MainButton.onClick(()=>{if(this.mainButtonCallback){this.mainButtonCallback();}else{WebApp.MainButton.hide();}});}}// Проверяем поддержку геолокации в Telegram\nthis.checkGeolocationSupport();// Адаптируем viewport для Telegram\nthis.adaptViewport();this.isInitialized=true;console.log('Telegram WebApp initialized successfully');}catch(error){console.error('Failed to initialize Telegram WebApp:',error);}}}checkGeolocationSupport(){// Проверяем, поддерживает ли Telegram WebApp геолокацию\nif(navigator.geolocation){console.log('Geolocation is supported in this Telegram WebApp');// Проверяем HTTPS\nif(location.protocol==='https:'||location.hostname==='localhost'){console.log('Secure context detected - geolocation should work');}else{console.warn('Insecure context - geolocation may not work');}}else{console.warn('Geolocation is not supported in this Telegram WebApp');}}applyTelegramTheme(){if(!this.isInitialized||!WebApp.themeParams)return;const themeParams=WebApp.themeParams;const root=document.documentElement;// Применяем цвета из Telegram\nif(themeParams.bg_color){root.style.setProperty('--tg-bg-color',themeParams.bg_color);document.body.style.backgroundColor=themeParams.bg_color;}if(themeParams.text_color){root.style.setProperty('--tg-text-color',themeParams.text_color);document.body.style.color=themeParams.text_color;}if(themeParams.hint_color){root.style.setProperty('--tg-hint-color',themeParams.hint_color);}if(themeParams.button_color){root.style.setProperty('--tg-button-color',themeParams.button_color);}if(themeParams.button_text_color){root.style.setProperty('--tg-button-text-color',themeParams.button_text_color);}// Устанавливаем data-theme атрибут для CSS\nconst colorScheme=WebApp.colorScheme||'light';root.setAttribute('data-theme',colorScheme);if(colorScheme==='dark'){root.classList.add('dark-theme');}else{root.classList.remove('dark-theme');}}adaptViewport(){if(!this.isInitialized)return;// Адаптация для мобильных устройств в Telegram\ndocument.body.style.margin='0';document.body.style.padding='0';document.body.style.height='100vh';document.body.style.overflow='hidden';document.body.style.position='fixed';document.body.style.top='0';document.body.style.left='0';document.body.style.right='0';document.body.style.bottom='0';// Обрабатываем изменение viewport\nif(WebApp.onEvent){WebApp.onEvent('viewportChanged',()=>{const height=WebApp.viewportHeight;document.documentElement.style.setProperty('--tg-viewport-height',\"\".concat(height,\"px\"));});}}getUser(){return this.user;}isTelegramApp(){var _window$Telegram2;return typeof window!=='undefined'&&((_window$Telegram2=window.Telegram)===null||_window$Telegram2===void 0?void 0:_window$Telegram2.WebApp)!==undefined;}// Управление главной кнопкой\nshowMainButton(){if(this.isInitialized&&WebApp.MainButton&&WebApp.MainButton.show){WebApp.MainButton.show();}}hideMainButton(){if(this.isInitialized&&WebApp.MainButton&&WebApp.MainButton.hide){WebApp.MainButton.hide();}}setMainButtonParams(params){if(this.isInitialized&&WebApp.MainButton&&WebApp.MainButton.setParams){WebApp.MainButton.setParams(params);}}setMainButtonCallback(callback){this.mainButtonCallback=callback;}clearMainButtonCallback(){this.mainButtonCallback=null;}// Управление кнопккой \"Назад\"\nshowBackButton(){if(this.isInitialized&&WebApp.BackButton&&WebApp.BackButton.show){WebApp.BackButton.show();}}hideBackButton(){if(this.isInitialized&&WebApp.BackButton&&WebApp.BackButton.hide){WebApp.BackButton.hide();}}setBackButtonCallback(callback){this.backButtonCallback=callback;}clearBackButtonCallback(){this.backButtonCallback=null;}// Всплывающие окна\nshowAlert(message){if(this.isInitialized&&this.isTelegramApp()&&WebApp.showAlert){try{WebApp.showAlert(message);}catch(error){console.warn('WebApp.showAlert not supported, fallback to alert:',error);alert(message);}}else{alert(message);}}showConfirm(message,callback){if(this.isInitialized&&this.isTelegramApp()&&WebApp.showConfirm){try{WebApp.showConfirm(message,callback);}catch(error){console.warn('WebApp.showConfirm not supported, fallback to confirm:',error);const confirmed=window.confirm(message);if(callback)callback(confirmed);}}else{const confirmed=window.confirm(message);if(callback)callback(confirmed);}}// Открытие ссылок\nopenLink(url){if(this.isInitialized&&WebApp.openLink){WebApp.openLink(url);}else{window.open(url,'_blank');}}openTelegramLink(url){if(this.isInitialized&&WebApp.openTelegramLink){WebApp.openTelegramLink(url);}else{window.open(url,'_blank');}}// Управление приложением\nclose(){if(this.isInitialized&&WebApp.close){WebApp.close();}}ready(){if(this.isInitialized&&WebApp.ready){WebApp.ready();}}expand(){if(this.isInitialized&&WebApp.expand){WebApp.expand();}}// Тема и оформление\ngetThemeParams(){if(this.isInitialized){return WebApp.themeParams;}return{};}getColorScheme(){if(this.isInitialized){return WebApp.colorScheme;}return'light';}getViewportHeight(){if(this.isInitialized){return WebApp.viewportHeight;}return window.innerHeight;}// Данные и события\nsendData(data){if(this.isInitialized&&WebApp.sendData){WebApp.sendData(data);}}openInvoice(url,callback){if(this.isInitialized&&WebApp.openInvoice){WebApp.openInvoice(url,callback);}}setHeaderColor(color){if(this.isInitialized&&WebApp.setHeaderColor){WebApp.setHeaderColor(color);}}setBackgroundColor(color){if(this.isInitialized&&WebApp.setBackgroundColor){WebApp.setBackgroundColor(color);}}// Haptic feedback\nimpactOccurred(){let style=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'medium';if(this.isInitialized&&this.isTelegramApp()&&WebApp.HapticFeedback){WebApp.HapticFeedback.impactOccurred(style);}}notificationOccurred(type){if(this.isInitialized&&this.isTelegramApp()&&WebApp.HapticFeedback){WebApp.HapticFeedback.notificationOccurred(type);}}selectionChanged(){if(this.isInitialized&&this.isTelegramApp()&&WebApp.HapticFeedback){WebApp.HapticFeedback.selectionChanged();}}// Получение initData для отправки на сервер\ngetInitData(){if(this.isInitialized){return WebApp.initData;}return null;}// Специальный метод для запроса геолокации в Telegram WebApp\nrequestGeolocation(){return new Promise((resolve,reject)=>{if(!navigator.geolocation){reject(new Error('Геолокация не поддерживается'));return;}const options={enableHighAccuracy:true,timeout:30000,maximumAge:600000};navigator.geolocation.getCurrentPosition(resolve,reject,options);});}// Проверка доступности геолокации\nisGeolocationAvailable(){return!!navigator.geolocation;}// Показать кнопку для запроса геолокации\nshowGeolocationButton(callback){if(this.isInitialized&&WebApp.MainButton){this.setMainButtonParams({text:'📍 Определить местоположение',color:'#007bff'});this.setMainButtonCallback(()=>{callback();// Скрываем кнопку после использования\nsetTimeout(()=>{this.hideMainButton();},2000);});this.showMainButton();}}// Показать кнопку повторного запроса геолокации\nshowRetryGeolocationButton(callback){if(this.isInitialized&&WebApp.MainButton){this.setMainButtonParams({text:'🔄 Попробовать снова',color:'#dc3545'});this.setMainButtonCallback(()=>{callback();});this.showMainButton();}}}export const telegramService=new TelegramService();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}