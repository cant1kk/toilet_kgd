{"ast":null,"code":"import{useState,useEffect}from'react';import{authAPI}from'../services/api';import{telegramService}from'../services/telegram';export const useTelegramAuth=()=>{const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const initAuth=async()=>{try{// Проверяем, есть ли сохраненный токен\nconst savedToken=localStorage.getItem('authToken');const savedUser=localStorage.getItem('user');if(savedToken&&savedUser){// Проверяем валидность токена\ntry{const currentUser=await authAPI.getCurrentUser();setUser(currentUser);setLoading(false);return;}catch(err){// Токен невалидный, удаляем его\nlocalStorage.removeItem('authToken');localStorage.removeItem('user');}}// Если мы в Telegram, пытаемся аутентифицироваться\nif(telegramService.isTelegramApp()){const authData=await authAPI.telegramAuth();// Сохраняем токен и данные пользователя\nlocalStorage.setItem('authToken',authData.token);localStorage.setItem('user',JSON.stringify(authData.user));setUser(authData.user);// Показываем уведомление об успешной аутентификации\ntelegramService.notificationOccurred('success');}else{// Вне Telegram просто устанавливаем загрузку в false\nconsole.log('Running outside Telegram WebApp - skipping authentication');}}catch(err){console.error('Auth error:',err);setError(err instanceof Error?err.message:'Authentication failed');if(telegramService.isTelegramApp()){telegramService.notificationOccurred('error');telegramService.showAlert('Ошибка аутентификации. Пожалуйста, попробуйте позже.');}else{console.error('Authentication error:',err);}}finally{setLoading(false);}};initAuth();},[]);const logout=()=>{localStorage.removeItem('authToken');localStorage.removeItem('user');setUser(null);setError(null);if(telegramService.isTelegramApp()){telegramService.showAlert('Вы вышли из системы');}};return{user,loading,error,isAuthenticated:!!user,isAdmin:(user===null||user===void 0?void 0:user.isAdmin)||false,logout};};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}