{"ast":null,"code":"import _objectSpread from\"d:/map for cur/toilet-finder-kaliningrad/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Card,Table,Button,Badge,Modal,Form,Alert,Spinner}from'react-bootstrap';import{toiletAPI,adminAPI}from'../services/api';import{telegramService}from'../services/telegram';import{useTelegramAuth}from'../hooks/useTelegramAuth';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminPanel=_ref=>{let{isTelegram}=_ref;const[toilets,setToilets]=useState([]);const[stats,setStats]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[showEditModal,setShowEditModal]=useState(false);const[editingToilet,setEditingToilet]=useState(null);const[actionLoading,setActionLoading]=useState(false);const{user,isAdmin}=useTelegramAuth();// Загрузка данных\nconst loadData=async()=>{try{setLoading(true);setError(null);const[toiletsData,statsData]=await Promise.all([adminAPI.getAllToilets(),adminAPI.getStats()]);setToilets(toiletsData);setStats(statsData);}catch(err){console.error('Error loading admin data:',err);setError('Не удалось загрузить данные');if(isTelegram){telegramService.showAlert('Ошибка загрузки данных');}}finally{setLoading(false);}};useEffect(()=>{if(isAdmin){loadData();}},[isAdmin]);// Утверждение туалета\nconst handleApprove=async id=>{try{setActionLoading(true);await adminAPI.approveToilet(id);setToilets(prev=>prev.map(t=>t.id===id?_objectSpread(_objectSpread({},t),{},{approved:true}):t));if(isTelegram){telegramService.notificationOccurred('success');}}catch(err){console.error('Error approving toilet:',err);if(isTelegram){telegramService.showAlert('Не удалось утвердить точку');}}finally{setActionLoading(false);}};// Удаление туалета\nconst handleDelete=async id=>{const confirmMessage='Вы уверены, что хотите удалить эту точку?';const confirmed=isTelegram?await new Promise(resolve=>{telegramService.showConfirm(confirmMessage,resolve);}):window.confirm(confirmMessage);if(!confirmed)return;try{setActionLoading(true);await adminAPI.rejectToilet(id);setToilets(prev=>prev.filter(t=>t.id!==id));if(isTelegram){telegramService.notificationOccurred('success');}}catch(err){console.error('Error deleting toilet:',err);if(isTelegram){telegramService.showAlert('Не удалось удалить точку');}}finally{setActionLoading(false);}};// Редактирование туалета\nconst handleEdit=toilet=>{setEditingToilet(toilet);setShowEditModal(true);};// Сохранение изменений\nconst handleSaveEdit=async()=>{if(!editingToilet)return;try{setActionLoading(true);const updated=await toiletAPI.update(editingToilet.id,editingToilet);setToilets(prev=>prev.map(t=>t.id===editingToilet.id?updated:t));setShowEditModal(false);setEditingToilet(null);if(isTelegram){telegramService.notificationOccurred('success');}}catch(err){console.error('Error updating toilet:',err);if(isTelegram){telegramService.showAlert('Не удалось обновить точку');}}finally{setActionLoading(false);}};// Проверка прав администратора\nif(!isAdmin){return/*#__PURE__*/_jsx(\"div\",{className:\"container mt-4\",children:/*#__PURE__*/_jsxs(Alert,{variant:\"danger\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u0414\\u043E\\u0441\\u0442\\u0443\\u043F \\u0437\\u0430\\u043F\\u0440\\u0435\\u0449\\u0435\\u043D\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u0423 \\u0432\\u0430\\u0441 \\u043D\\u0435\\u0442 \\u043F\\u0440\\u0430\\u0432 \\u0430\\u0434\\u043C\\u0438\\u043D\\u0438\\u0441\\u0442\\u0440\\u0430\\u0442\\u043E\\u0440\\u0430 \\u0434\\u043B\\u044F \\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u0430 \\u043A \\u044D\\u0442\\u043E\\u0439 \\u043F\\u0430\\u043D\\u0435\\u043B\\u0438.\"})]})});}if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-4 text-center\",children:[/*#__PURE__*/_jsx(Spinner,{animation:\"border\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445...\"})]});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"container mt-4\",children:/*#__PURE__*/_jsxs(Alert,{variant:\"danger\",children:[error,/*#__PURE__*/_jsx(Button,{variant:\"outline-danger\",className:\"ms-2\",onClick:loadData,children:\"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u043E\\u0432\\u0430\\u0442\\u044C \\u0441\\u043D\\u043E\\u0432\\u0430\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-4 \".concat(isTelegram?'telegram-admin':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041F\\u0430\\u043D\\u0435\\u043B\\u044C \\u0430\\u0434\\u043C\\u0438\\u043D\\u0438\\u0441\\u0442\\u0440\\u0430\\u0442\\u043E\\u0440\\u0430\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:loadData,disabled:loading,children:\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C\"})]}),stats&&/*#__PURE__*/_jsxs(\"div\",{className:\"row mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3 mb-3\",children:/*#__PURE__*/_jsx(Card,{className:\"text-center\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-primary\",children:stats.total}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-0\",children:\"\\u0412\\u0441\\u0435\\u0433\\u043E \\u0442\\u043E\\u0447\\u0435\\u043A\"})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3 mb-3\",children:/*#__PURE__*/_jsx(Card,{className:\"text-center\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-success\",children:stats.approved}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-0\",children:\"\\u0423\\u0442\\u0432\\u0435\\u0440\\u0436\\u0434\\u0435\\u043D\\u043E\"})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3 mb-3\",children:/*#__PURE__*/_jsx(Card,{className:\"text-center\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-warning\",children:stats.pending}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-0\",children:\"\\u041D\\u0430 \\u043C\\u043E\\u0434\\u0435\\u0440\\u0430\\u0446\\u0438\\u0438\"})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3 mb-3\",children:/*#__PURE__*/_jsx(Card,{className:\"text-center\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-info\",children:stats.today}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-0\",children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u043B\\u0435\\u043D\\u043E \\u0441\\u0435\\u0433\\u043E\\u0434\\u043D\\u044F\"})]})})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{children:/*#__PURE__*/_jsxs(\"h5\",{className:\"mb-0\",children:[\"\\u0412\\u0441\\u0435 \\u0442\\u043E\\u0447\\u043A\\u0438 (\",toilets.length,\")\"]})}),/*#__PURE__*/_jsx(Card.Body,{className:\"p-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(Table,{hover:true,className:\"mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0410\\u0434\\u0440\\u0435\\u0441\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0422\\u0438\\u043F\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0414\\u0430\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u044F\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:toilets.map(toilet=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:toilet.id}),/*#__PURE__*/_jsx(\"td\",{children:toilet.name}),/*#__PURE__*/_jsx(\"td\",{children:toilet.address}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:toilet.type==='free'?'success':toilet.type==='paid'?'danger':'warning',children:toilet.type==='free'?'Бесплатный':toilet.type==='paid'?'Платный':'За покупку'})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:toilet.approved?'success':'warning',children:toilet.approved?'Утверждено':'На модерации'})}),/*#__PURE__*/_jsx(\"td\",{children:new Date(toilet.created_at).toLocaleDateString('ru-RU')}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"btn-group\",role:\"group\",children:[/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"outline-primary\",onClick:()=>handleEdit(toilet),disabled:actionLoading,children:\"\\u270F\\uFE0F\"}),!toilet.approved&&/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"outline-success\",onClick:()=>handleApprove(toilet.id),disabled:actionLoading,children:\"\\u2705\"}),/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"outline-danger\",onClick:()=>handleDelete(toilet.id),disabled:actionLoading,children:\"\\uD83D\\uDDD1\\uFE0F\"})]})})]},toilet.id))})]})})})]}),/*#__PURE__*/_jsxs(Modal,{show:showEditModal,onHide:()=>setShowEditModal(false),centered:true,size:\"lg\",className:isTelegram?'telegram-modal':'',children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0442\\u043E\\u0447\\u043A\\u0438\"})}),editingToilet&&/*#__PURE__*/_jsxs(Form,{onSubmit:e=>{e.preventDefault();handleSaveEdit();},children:[/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:editingToilet.name,onChange:e=>setEditingToilet(_objectSpread(_objectSpread({},editingToilet),{},{name:e.target.value})),disabled:actionLoading})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\u0410\\u0434\\u0440\\u0435\\u0441\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:editingToilet.address,onChange:e=>setEditingToilet(_objectSpread(_objectSpread({},editingToilet),{},{address:e.target.value})),disabled:actionLoading})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\u0422\\u0438\\u043F\"}),/*#__PURE__*/_jsxs(Form.Select,{value:editingToilet.type,onChange:e=>setEditingToilet(_objectSpread(_objectSpread({},editingToilet),{},{type:e.target.value})),disabled:actionLoading,children:[/*#__PURE__*/_jsx(\"option\",{value:\"free\",children:\"\\u0411\\u0435\\u0441\\u043F\\u043B\\u0430\\u0442\\u043D\\u044B\\u0439\"}),/*#__PURE__*/_jsx(\"option\",{value:\"paid\",children:\"\\u041F\\u043B\\u0430\\u0442\\u043D\\u044B\\u0439\"}),/*#__PURE__*/_jsx(\"option\",{value:\"purchase_required\",children:\"\\u0422\\u043E\\u043B\\u044C\\u043A\\u043E \\u0434\\u043B\\u044F \\u043F\\u043E\\u043A\\u0443\\u043F\\u0430\\u0442\\u0435\\u043B\\u0435\\u0439\"})]})]}),editingToilet.type==='paid'&&/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\u0426\\u0435\\u043D\\u0430\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:editingToilet.price||'',onChange:e=>setEditingToilet(_objectSpread(_objectSpread({},editingToilet),{},{price:e.target.value})),disabled:actionLoading})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\u041E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:3,value:editingToilet.description||'',onChange:e=>setEditingToilet(_objectSpread(_objectSpread({},editingToilet),{},{description:e.target.value})),disabled:actionLoading})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>setShowEditModal(false),disabled:actionLoading,children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",disabled:actionLoading,children:actionLoading?'Сохранение...':'Сохранить'})]})]})]})]});};export default AdminPanel;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}