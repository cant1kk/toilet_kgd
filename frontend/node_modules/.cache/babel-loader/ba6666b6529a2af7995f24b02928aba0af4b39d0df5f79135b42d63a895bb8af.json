{"ast":null,"code":"// Геокодинг через OpenStreetMap Nominatim API (бесплатный)\nconst NOMINATIM_API='https://nominatim.openstreetmap.org/search';// Cache для геокодинга\nconst geocodeCache=new Map();// Simple debounce implementation\nconst debounce=(func,delay)=>{let timeoutId;let lastResolve=null;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return new Promise(resolve=>{if(timeoutId){clearTimeout(timeoutId);}lastResolve=resolve;timeoutId=setTimeout(async()=>{try{const result=await func(...args);if(lastResolve){lastResolve(result);}}catch(error){if(lastResolve){lastResolve(error);}}},delay);});};};const geocodeAddressInternal=async address=>{try{// Проверяем кэш\nif(geocodeCache.has(address)){return geocodeCache.get(address);}// Добавляем \"Калининград\" для точности поиска\nconst searchQuery=\"\".concat(address,\", \\u041A\\u0430\\u043B\\u0438\\u043D\\u0438\\u043D\\u0433\\u0440\\u0430\\u0434, \\u0420\\u043E\\u0441\\u0441\\u0438\\u044F\");const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),5000);// 5 секунд таймаут\nconst response=await fetch(\"\".concat(NOMINATIM_API,\"?format=json&q=\").concat(encodeURIComponent(searchQuery),\"&limit=1&countrycodes=ru\"),{headers:{'User-Agent':'ToiletFinder Kaliningrad App'},signal:controller.signal});clearTimeout(timeoutId);if(!response.ok){throw new Error('Geocoding request failed');}const data=await response.json();if(data.length===0){return null;}const result=data[0];// Сохраняем в кэш\ngeocodeCache.set(address,result);return result;}catch(error){console.error('Geocoding error:',error);return null;}};// Экспортируем debounced версию\nexport const geocodeAddress=debounce(geocodeAddressInternal,500);// Валидация формата адреса\nexport const validateAddress=address=>{// Базовая проверка - должен содержать улицу и номер дома\nconst streetPatterns=[/^[а-яА-ЯёЁ\\s]+\\s+\\d+/i,// ул. Ленина 15\n/^[а-яА-ЯёЁ\\s]+\\s+[а-яА-ЯёЁ]+\\s+\\d+/i,// Ленинский проспект 30\n/^[а-яА-ЯёЁ\\s]+\\s+д\\.?\\s*\\d+/i// ул. Ленина д.15\n];return streetPatterns.some(pattern=>pattern.test(address.trim()));};// Форматирование адреса для отображения\nexport const formatAddress=address=>{return address.trim().replace(/\\s+/g,' ');};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}